N = nrow(.x)
))
)
#################################################
# Stage Two - CLaM
#################################################
Stage01_results %>% ungroup() %>%
# Drop the columns with model and lambdas
select(-c(model, data, lambdas_makeham)) %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
data = map2(data, model, ~data_frame(
L = .y$coefficients[1],
`L Std.Err` = .y$coefficients[1,2],
`L t-val` = .y$coefficients[1,3],
`x*` = -.y$coefficients[2],
`-x* Std.Err` = .y$coefficients[2,2],
`-x* t-val` = .y$coefficients[2,3],
g_mean = mean(.x$g),
g_min = min(.x$g),
g_max = max(.x$g),
lambda_min = min(.x$lambda_makeham),
lambda_max = max(.x$lambda_makeham),
`Adj. R2` = .y$adj.r.squared,
N = nrow(.x)
))
)
#################################################
# Stage Two - CLaM
#################################################
Stage01_results %>% ungroup() %>%
# Drop the columns with model and lambdas
select(-c(model, data, lambdas_makeham)) %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
data = map2(data, model, ~data_frame(
L = .y$coefficients[1],
`L Std.Err` = .y$coefficients[1,2],
`L t-val` = .y$coefficients[1,3],
`x*` = -.y$coefficients[2],
`-x* Std.Err` = .y$coefficients[2,2],
`-x* t-val` = .y$coefficients[2,3],
g_mean = mean(.x$g),
g_min = min(.x$g),
g_max = max(.x$g),
lambda_min = min(.x$lambda_makeham),
lambda_max = max(.x$lambda_makeham),
`Adj. R2` = .y$adj.r.squared,
N = nrow(.x)
))
) %>% unnest(data) ->
Stage02_results
Stage02_results
#################################################
# Stage Two - View and Save Results
#################################################
Stage02_results %>% ungroup() %>%
select(-model) %>%
mutate(
`Adj. R2` = percent(`Adj. R2`, acc =0.01),
`Range: g` = paste0("(", percent(g_min), ', ', percent(g_max), ')' ),
`Plateau: λ*` = paste0("(", round(lambda_min, 4), ', ', round(lambda_max, 4), ')' ),
) %>%
mutate_if(is.numeric, ~round(., 2)) %>%
select(
Gender,
L , `x*`,
`L Std.Err`, `-x* Std.Err`,
`L t-val` , `-x* t-val`,
`Adj. R2`,
`Range: g`,
g_mean,
`Plateau: λ*`,
N
) %>%
rename(`Average: g` = g_mean, Countries = N)
#################################################
# Stage Two - View and Save Results
#################################################
Stage02_results %>% ungroup() %>%
select(-model) %>%
mutate(
`Adj. R2` = percent(`Adj. R2`, acc =0.01),
`Range: g` = paste0("(", percent(g_min), ', ', percent(g_max), ')' ),
`Plateau: λ*` = paste0("(", round(lambda_min, 4), ', ', round(lambda_max, 4), ')' ),
) %>%
mutate_if(is.numeric, ~round(., 2)) %>%
select(
Gender,
L , `x*`,
`L Std.Err`, `-x* Std.Err`,
`L t-val` , `-x* t-val`,
`Adj. R2`,
`Range: g`,
g_mean,
`Plateau: λ*`,
N
) %>%
rename(`Average: g` = g_mean, Countries = N) ->
Table2
Table2 %>% View("Table - 2 -")
Table2 %>% t
Table2 %>% gather(Gender, Value)
Table2 %>% gather(Gender, Value, -Gender)
Table2 %>% gather(k, v, -Gender)
Table2 %>%
gather(Stat, v, -Gender) %>%
group_by(Stat) %>% spread(Gender, v)
#################################################
# Stage Two - View and Save Results
#################################################
Stage02_results %>% ungroup() %>%
select(-model) %>%
mutate(
`Adj. R2` = percent(`Adj. R2`, acc =0.01),
`Range: g` = paste0("(", percent(g_min), ', ', percent(g_max), ')' ),
`Plateau: λ*` = paste0("(", round(lambda_min, 4), ', ', round(lambda_max, 4), ')' ),
) %>%
mutate_if(is.numeric, ~round(., 2)) %>%
select(
Gender,
L , `x*`,
`L Std.Err`, `-x* Std.Err`,
`L t-val` , `-x* t-val`,
`Adj. R2`,
`Range: g`,
g_mean,
`Plateau: λ*`,
N
) %>%
rename(`Average: g` = g_mean, Countries = N) %>%
gather(Stat, v, -Gender) %>%
group_by(Stat) %>%
spread(Gender, v)
#################################################
# Stage Two - View and Save Results
#################################################
Stage02_results %>% ungroup() %>%
select(-model) %>%
mutate(
`Adj. R2` = percent(`Adj. R2`, acc =0.01),
`Range: g` = paste0("(", percent(g_min), ', ', percent(g_max), ')' ),
`Plateau: λ*` = paste0("(", round(lambda_min, 4), ', ', round(lambda_max, 4), ')' ),
) %>%
mutate_if(is.numeric, ~round(., 2)) %>%
select(
Gender,
L , `x*`,
`L Std.Err`, `-x* Std.Err`,
`L t-val` , `-x* t-val`,
`Adj. R2`,
`Range: g`,
g_mean,
`Plateau: λ*`,
N
) %>%
rename(`Average: g` = g_mean, Countries = N) %>%
gather(Stat, v, -Gender) %>%
group_by(Stat) %>%
spread(Gender, v) -> Table2
Table2 %>% View("Table - 2 -")
#################################################
# Stage Two - View and Save Results
#################################################
Stage02_results %>% ungroup() %>%
select(-model) %>%
mutate(
`Adj. R2` = percent(`Adj. R2`, acc =0.01),
`Range: g` = paste0("(", percent(g_min), ', ', percent(g_max), ')' ),
`Plateau: λ*` = paste0("(", round(lambda_min, 4), ', ', round(lambda_max, 4), ')' ),
) %>%
mutate_if(is.numeric, ~round(., 2)) %>%
select(
Gender,
L , `x*`,
`L Std.Err`, `-x* Std.Err`,
`L t-val` , `-x* t-val`,
`Adj. R2`,
`Range: g`,
g_mean,
`Plateau: λ*`,
N
) %>%
rename(`Average: g` = g_mean, Countries = N) %>%
gather(`Statistic`, v, -Gender) %>%
group_by(Statistic) %>%
spread(Gender, v) -> Table2
Table2 %>% write_csv("data/02_paper_tables/Table-02.csv")
#################################################
# Stage Two - View and Save Results
#################################################
Stage02_results %>% ungroup() %>%
select(-model) %>%
mutate(
`Adj. R2` = percent(`Adj. R2`, acc =0.01),
`Range: g` = paste0("(", percent(g_min), ', ', percent(g_max), ')' ),
`Plateau: λ*` = paste0("(", round(lambda_min, 4), ', ', round(lambda_max, 4), ')' ),
) %>%
mutate_if(is.numeric, ~round(., 2)) %>%
select(
Gender,
L , `x*`,
`L Std.Err`, `-x* Std.Err`,
`L t-val` , `-x* t-val`,
`Adj. R2`,
`Range: g`,
g_mean,
`Plateau: λ*`,
N
) %>%
rename(`Average: g` = g_mean, Countries = N) %>%
gather(`Statistic`, v, -Gender) %>%
group_by(Statistic) %>%
spread(Gender, v)
#################################################
# Stage Two - View and Save Results
#################################################
Stage02_results %>% ungroup() %>%
select(-model) %>%
mutate(
`Adj. R2` = percent(`Adj. R2`, acc =0.01),
`Range: g` = paste0("(", percent(g_min), ', ', percent(g_max), ')' ),
`Plateau: λ*` = paste0("(", round(lambda_min, 4), ', ', round(lambda_max, 4), ')' ),
) %>%
mutate_if(is.numeric, ~round(., 2)) %>%
select(
Gender,
L , `x*`,
`L Std.Err`, `-x* Std.Err`,
`L t-val` , `-x* t-val`,
`Adj. R2`,
`Range: g`,
g_mean,
`Plateau: λ*`,
N
) %>%
rename(`Average: g` = g_mean, Countries = N) ->
Table2
Table2 %>% write_csv("data/02_paper_tables/Table-02.csv")
Table2 %>% View("Table - 2 -")
Stage02_results
Stage02_results
#################################################
# Stage Two - CLaM
#################################################
Stage01_results %>% ungroup() %>%
# Drop the columns with model and lambdas
select(-c(model, data, lambdas_makeham)) %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map2(data, model, ~data_frame(
L = .y$coefficients[1],
`x*` = -.y$coefficients[2],
`Adj. R2` = .y$adj.r.squared,
N = nrow(.x)
))
) ->
Stage02_results
Stage02_results
Stage02_results$data
Stage02_results$data[[1]]
Stage02_results$data[[1]]
#################################################
# Stage Two - View and Save Results
#################################################
lxg = function(x, g, xx, lmd, lmd_m) ifelse(x < xx , lmd + (lmd_m-lmd)*exp(g*(x-xx)), lmd_m )
lxg
Stage02_results$data[[1]]
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Drop the columns with model and lambdas
select(-c(model, data, lambdas_makeham)) %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
))
) ->
Stage02_results
Stage02_results
Stage02_results$data
Stage02_results$data[[1]]
Stage02_results$data[[1]]
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Drop the columns with model and lambdas
#select(-c(model, data, lambdas_makeham)) %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
))
) ->
Stage02_results
Stage02_results$data[[1]]
Stage02_results$data[[1]]
Stage02_results$data[[1]]$data[[1]]
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
)),
lambdas_x = map2(data, parameters, ~lxg(
x = 35:95,
xx = .y$`x*`,
lmd_m = .x$lambda_makeham,
lmd = .x$data$lambda
))
) ->
Stage02_results
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
)),
lambdas_x = map2(data, parameters, ~lxg(
x = 35:95,
xx = .y$`x*`,
lmd_m = .x$lambda_makeham,
lmd = .x$data$lambda,
g = .x$g
))
) ->
Stage02_results
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
)),
lambdas_x = map2(data, parameters, ~.x %>% group_by(Country))
) ->
Stage02_results
Stage02_results$lambdas_x
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
)),
lambdas_x = map2(data, parameters, ~.x %>% group_by(Country) %>% summarise(
lxg(
x = 35:95,
xx = .y$`x*`,
lmd_m = .lambda_makeham,
lmd = data$lambda,
g = g
)
))
) ->
Stage02_results
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
)),
lambdas_x = map2(data, parameters, ~.x %>% group_by(Country) %>% summarise(
lxg(
x = 35:95,
xx = .y$`x*`,
lmd_m = lambda_makeham,
lmd = data$lambda,
g = g
)
))
) ->
Stage02_results
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
)),
lambdas_x = map2(data, parameters, ~.x %>% group_by(Country) %>% mutate(
lxg(
x = 35:95,
xx = .y$`x*`,
lmd_m = lambda_makeham,
lmd = data$lambda,
g = g
)
))
) ->
Stage02_results
# Compute Global parameters
Stage01_results %>% ungroup() %>%
# Group by gender
group_by(Gender) %>% nest %>%
mutate(
# Run the second regression
model = map(data, ~summary(lm(lnh~g, data=.))),
# Extract parameters and statistics
parameters = map(model, ~data_frame(
L = .$coefficients[1],
`x*` = -.$coefficients[2],
`Adj. R2` = .$adj.r.squared
)),
lambdas_x = map2(data, parameters, ~.x %>% group_by(Country) %>% mutate(
lxg = map(data, function(d) lxg(
x = 35:95,
xx = .y$`x*`,
lmd_m = lambda_makeham,
lmd = d$lambda,
g = g
))
))
) ->
Stage02_results
Stage02_results$lambdas_x[[1]]
Stage02_results$lambdas_x[[1]]$lxg
Stage02_results$lambdas_x[[1]]$lxg[[1]]
10 %% 2
10 %% 3
source('~/.active-rstudio-document', echo=TRUE)
f(c(2, 3, 6, 11))
x = c(2, 3, 6, 11)
div2 = x %% 2
div2
div3
div3 = x %% 3
div3
?ifelse
?if_else
if_else(div3, 1, 9)
ifelse(div3, 1, 9)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
div2 = x %% 2
div3 = x %% 3
div3 & div2
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
10+15+35+30+5
